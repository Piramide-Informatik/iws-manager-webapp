<div class="work-packages-container">
    <h2>Work Packages</h2>

    <div class="test-message" *ngIf="testMessage">
        <p>{{ testMessage }}</p>
    </div>


    <div class="table-container">
        <table class="excel-table">
            <thead>
                <tr>
                    <th rowspan="2" class="gray" id="header-ap">AP</th>
                    <th rowspan="2" class="gray" id="header-ap-nr">AP-Nr</th>
                    <th rowspan="2" class="gray" id="header-pers-nr">Pers.Nr</th>
                    <th colspan="2" id="header-bewilligt">bewilligt</th>
                    <th colspan="3" id="header-geplant">geplant</th>
                    <th colspan="3" id="header-abgerechnet">abgerechnet</th>
                    <th colspan="3" id="header-verfuegbar">verfügbar</th>
                </tr>
                <tr>
                    <th class="green" id="header-pm-bewilligt">PM</th>
                    <th class="green" id="header-pers-kosten-bewilligt">Pers.Kosten</th>
                    <th class="orange" id="header-pm-geplant">PM</th>
                    <th class="orange" id="header-std-geplant">Std.</th>
                    <th class="orange" id="header-pers-kosten-geplant">Pers.Kosten</th>
                    <th class="red" id="header-pm-abgerechnet">PM</th>
                    <th class="red" id="header-std-abgerechnet">Std.</th>
                    <th class="red" id="header-pers-kosten-abgerechnet">Pers.Kosten</th>
                    <th class="blue" id="header-pm-verfuegbar">PM</th>
                    <th class="blue" id="header-std-verfuegbar">Std.</th>
                    <th class="blue" id="header-pers-kosten-verfuegbar">Pers.Kosten</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let row of rows; let i = index">
                    <!-- AP -->
                    <td headers="header-ap">
                        <span *ngIf="editingRowIndex !== i">{{ row.ap }}</span>
                        <input *ngIf="editingRowIndex === i" type="text" [(ngModel)]="row.ap" class="input-field">
                    </td>

                    <!-- AP-Nr -->
                    <td headers="header-ap-nr">
                        <span *ngIf="editingRowIndex !== i">{{ row.apNr }}</span>
                        <input *ngIf="editingRowIndex === i" type="text" [(ngModel)]="row.apNr" class="input-field">
                    </td>

                    <!-- Pers.Nr -->
                    <td headers="header-pers-nr">
                        <span *ngIf="editingRowIndex !== i">{{ row.persNr }}</span>
                        <input *ngIf="editingRowIndex === i" type="text" [(ngModel)]="row.persNr" class="input-field">
                    </td>

                    <!-- bewilligt - PM -->
                    <td headers="header-pm-bewilligt" class="green">
                        <span *ngIf="editingRowIndex !== i">{{ formatNumber(row.pmBewilligt) }}</span>
                        <input *ngIf="editingRowIndex === i" type="number" step="0.01" [(ngModel)]="row.pmBewilligt"
                            (input)="onInputChange()" class="input-field ">
                    </td>

                    <!-- bewilligt - Pers.Kosten -->
                    <td headers="header-pers-kosten-bewilligt">
                        <span *ngIf="editingRowIndex !== i">{{ formatNumber(row.persKostenBewilligt) }}</span>
                        <input *ngIf="editingRowIndex === i" type="number" step="0.01"
                            [(ngModel)]="row.persKostenBewilligt" (input)="onInputChange()" class="input-field ">
                    </td>

                    <!-- geplant - PM -->
                    <td headers="header-pm-geplant" class="green">
                        <span *ngIf="editingRowIndex !== i">{{ formatNumber(row.pmGeplant) }}</span>
                        <input *ngIf="editingRowIndex === i" type="number" step="0.01" [(ngModel)]="row.pmGeplant"
                            (input)="onInputChange()" class="input-field ">
                    </td>

                    <!-- geplant - Std. -->
                    <td headers="header-std-geplant">
                        <span *ngIf="editingRowIndex !== i">{{ formatNumber(row.stdGeplant) }}</span>
                        <input *ngIf="editingRowIndex === i" type="number" step="0.01" [(ngModel)]="row.stdGeplant"
                            (input)="onInputChange()" class="input-field ">
                    </td>

                    <!-- geplant - Pers.Kosten -->
                    <td headers="header-pers-kosten-geplant">
                        <span *ngIf="editingRowIndex !== i">{{ formatNumber(row.persKostenGeplant) }}</span>
                        <input *ngIf="editingRowIndex === i" type="number" step="0.01"
                            [(ngModel)]="row.persKostenGeplant" (input)="onInputChange()" class="input-field ">
                    </td>

                    <!-- abgerechnet - PM -->
                    <td headers="header-pm-abgerechnet" class="green">
                        <span *ngIf="editingRowIndex !== i">{{ formatNumber(row.pmAbgerechnet) }}</span>
                        <input *ngIf="editingRowIndex === i" type="number" step="0.01" [(ngModel)]="row.pmAbgerechnet"
                            (input)="onInputChange()" class="input-field ">
                    </td>

                    <!-- abgerechnet - Std. -->
                    <td headers="header-std-abgerechnet">
                        <span *ngIf="editingRowIndex !== i">{{ formatNumber(row.stdAbgerechnet) }}</span>
                        <input *ngIf="editingRowIndex === i" type="number" step="0.01" [(ngModel)]="row.stdAbgerechnet"
                            (input)="onInputChange()" class="input-field ">
                    </td>

                    <!-- abgerechnet - Pers.Kosten -->
                    <td headers="header-pers-kosten-abgerechnet">
                        <span *ngIf="editingRowIndex !== i">{{ formatNumber(row.persKostenAbgerechnet) }}</span>
                        <input *ngIf="editingRowIndex === i" type="number" step="0.01"
                            [(ngModel)]="row.persKostenAbgerechnet" (input)="onInputChange()" class="input-field ">
                    </td>

                    <!-- verfügbar (solo lectura) -->
                    <td headers="header-pm-verfuegbar" class="green">{{ formatNumber(row.pmVerfuegbar) }}</td>
                    <td headers="header-std-verfuegbar">{{ formatNumber(row.stdVerfuegbar) }}</td>
                    <td headers="header-pers-kosten-verfuegbar">{{ formatNumber(row.persKostenVerfuegbar) }}</td>
                </tr>
            </tbody>
        </table>
    </div>
    <button (click)="addRow()" class="btn-add">➕ Añadir Fila</button>
</div>