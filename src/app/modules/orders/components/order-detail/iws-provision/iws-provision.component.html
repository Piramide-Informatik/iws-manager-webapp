<p-card [style]="{ background: 'var(--light-cyan)' }">
  <ng-template #title>{{ 'FRAMEWORK-AGREEMENTS.DETAIL.FORM_TABLE_IWS_COMMISSION.TITLE_TABLE' | translate}}</ng-template>
  <form [formGroup]="orderForm" (ngSubmit)="onSubmit()">
    <div class="align-items-center mb-2">
      <div class="iws-employeeInput project_name mb-2">
        <label for="fixCommission">{{ 'ORDERS.COMMISSIONS.FIXED_COMMISSION' | translate }}</label>
        <p-inputnumber mode="decimal" [max]="999.99" [min]="0" [useGrouping]="true" 
          [minFractionDigits]="2" [maxFractionDigits]="2" locale="de-DE" [inputStyle]="{'text-align': 'right'}"
          inputId="fixCommission"
          formControlName="fixCommission"
          autocomplete="off"
        />
        Euro
      </div>
      <div class="iws-employeeInput order_maxCommission mb-2">
        <label for="maxCommission">{{ 'ORDERS.COMMISSIONS.MAX_COMMISSION' | translate }}</label>
        <p-inputnumber mode="decimal" [max]="99999.99" [min]="0" [useGrouping]="true" 
          [minFractionDigits]="2" [maxFractionDigits]="2" locale="de-DE" [inputStyle]="{'text-align': 'right'}"
          id="maxCommission"
          formControlName="maxCommission"
          autocomplete="off"
        />
        Euro
      </div>
    </div>
    <master-data-genaral-table
    [tableId]="tableKey"
    [tableValues]="orderCommissions"
    [columns]="cols"
    [userPreferences]="userIwsProvisionPreferences"
    [dataKeys]="dataKeys"
    [disableButtons]="disabledButtonsTable"
    (onColumnChanges)="onUserIwsProvisionPreferencesChanges($event)"
    (onEditRegister)="showModalIwsCommission('edit', $event)"
    (onDeleteRegister)="deleteCommission($event)"
    (onCreateRegister)="showModalIwsCommission('create')"
    ></master-data-genaral-table>
    
    <div class="row">
      <div class="col-12">
        <div class="flex justify-content-end align-items-center">
          <label class="me-2" for="estimated">{{ 'ORDERS.COMMISSIONS.ESTIMATED_IWS_COMMISSION' | translate }}</label>
          <p-inputnumber mode="decimal" [max]="99999.99" [min]="0" [useGrouping]="true" 
            [minFractionDigits]="2" [maxFractionDigits]="2" locale="de-DE" [inputStyle]="{'text-align': 'right'}"
            inputId="estimated"
            formControlName="iwsProvision"
            autocomplete="off"
            readonly
            [disabled]="true"
          />
        </div>
      </div>
    </div>
  </form>
</p-card>

<!-- Modal IWS Commission -->
<div class="card">
  <p-dialog
    [header]="'ORDERS.COMMISSIONS.TITLE_DIALOG_' + typeModal.toUpperCase() | translate"
    (onHide)="closeModalIwsCommission()"
    [modal]="true"
    [(visible)]="visibleModalIWSCommission"
    [style]="{ width: '35rem' }"
  >
   @if (typeModal !== 'delete') {
     <form [formGroup]="iwsCommissionForm" (ngSubmit)="onSubmitIwsCommission()">
      <div class="form-item-commission mt-4">
        <label for="fromValue">{{ 'ORDERS.COMMISSIONS.FROM_VALUE' | translate }}</label>
        <p-inputnumber #inputNumber mode="decimal" [max]="99999999.99" [min]="0" [useGrouping]="true" 
          [minFractionDigits]="2" [maxFractionDigits]="2" locale="de-DE" [inputStyle]="{'text-align': 'right'}"
          inputId="fromValue"
          class="flex-auto"
          formControlName="fromOrderValue"
          autocomplete="off"
        />
      </div>
      <div class="form-item-commission">
        <label for="commission">{{ 'ORDERS.COMMISSIONS.COMMISSION' | translate }} (%)</label>
        <div class="input-message">
          <p-inputnumber mode="decimal" [min]="0" [useGrouping]="true" 
            [minFractionDigits]="2" [maxFractionDigits]="2" locale="de-DE" [inputStyle]="{'text-align': 'right'}"
          inputId="commission"
          class="flex-auto"
          formControlName="commission"
          autocomplete="off" invalid="
           iwsCommissionForm.get('commission')?.invalid  
            && iwsCommissionForm.get('commission')?.dirty 
            || iwsCommissionForm.get('commission')?.touched"/> 
          <p-message severity="error" [showTransitionOptions]="'0ms'" variant="simple" size="small" *ngIf="
            iwsCommissionForm.get('commission')?.invalid && 
            iwsCommissionForm.get('commission')?.dirty
            ">{{ 'ERROR.NUMBER_MAX' | translate }}</p-message>
        </div>
      </div>
      <div class="form-item-commission">
        <label for="minCommission">{{ 'ORDERS.COMMISSIONS.MIN_COMMISSION' | translate }}</label>
        <p-inputnumber mode="decimal" [max]="99999.99" [min]="0" [useGrouping]="true" 
            [minFractionDigits]="2" [maxFractionDigits]="2" locale="de-DE" [inputStyle]="{'text-align': 'right'}"
          inputId="minCommission"
          class="flex-auto"
          formControlName="minCommission"
          autocomplete="off"
        />
      </div>
      <div class="flex justify-content-center gap-2">
        <p-button
          [label]="'BUTTONS.SAVE' | translate"
          icon="pi pi-check"
          size="small"
          iconPos="left"
          type="submit"
          [loading]="isLoading"
          [disabled]="iwsCommissionForm.invalid"
        ></p-button>

        @if(selectedOrderCommission) {
          <p-button type="button" class="delete" size="small" [label]="'BUTTONS.DELETE' | translate" icon="pi pi-trash"
          iconPos="left" (onClick)="this.visibleModalIWSCommissionEntity = true;" severity="danger" [loading]="isLoading"
          [disabled]="isLoading" />
        }

        <p-button
          [label]="'BUTTONS.CANCEL' | translate"
          icon="pi pi-times"
          iconPos="left"
          size="small"
          class="cancel"
          [disabled]="isLoading"
          (click)="closeModalIwsCommission()"
          (keydown.enter)="closeModalIwsCommission()"
        ></p-button>
      </div>
    </form>
   } @else {
     <div class="delete-confirmation-component mb-2 mt-4 justify-content-center ">
      <p class="mb-4">
        {{ 'ORDERS.REMOVE_ORDER_IWS_COMMISSION_QUESTION' | translate }}
        <strong class="stronglock mt-1">"{{ selectedOrderCommission?.fromOrderValue | number:'1.2-2':'de-DE' }}"?</strong>
      </p>

      <div class="flex justify-content-center gap-2">
        <p-button type="button" class="delete" size="small" [label]="'BUTTONS.DELETE' | translate" icon="pi pi-trash"
          iconPos="left" (onClick)="onIwsCommissionDeleteConfirm()" severity="danger" [loading]="isLoading"
          [disabled]="isLoading" />
        <p-button type="button" class="cancel" size="small" [label]="'BUTTONS.CANCEL' | translate" icon="pi pi-times"
          iconPos="left" (onClick)="this.visibleModalIWSCommission = false;" [disabled]="isLoading" />
      </div>
    </div>
   }
    
  </p-dialog>
</div>
<div class="card">
  <p-dialog
    [header]="'ORDERS.COMMISSIONS.TITLE_DIALOG_DELETE' | translate"
    (onHide)="this.visibleModalIWSCommissionEntity = false;"
    [modal]="true"
    [(visible)]="visibleModalIWSCommissionEntity"
    [style]="{ width: '35rem' }"
  >
    <div class="delete-confirmation-component-entity mb-2 mt-4 justify-content-center ">
      <p class="mb-4 delete-confirmation-component-entity-title">
        {{ 'ORDERS.REMOVE_ORDER_IWS_COMMISSION_QUESTION' | translate }}
        <strong class="stronglock mt-1">"{{ selectedOrderCommission?.fromOrderValue | number:'1.2-2':'de-DE' }}"?</strong>
      </p>

      <div class="flex justify-content-center gap-2 delete-confirmation-component-entity-buttons">
        <p-button type="button" class="delete" size="small" [label]="'BUTTONS.DELETE' | translate" icon="pi pi-trash"
          iconPos="left" (onClick)="onIwsCommissionDeleteConfirm()" severity="danger" [loading]="isLoading"
          [disabled]="isLoading" />
        <p-button type="button" class="cancel" size="small" [label]="'BUTTONS.CANCEL' | translate" icon="pi pi-times"
          iconPos="left" (onClick)="this.visibleModalIWSCommissionEntity = false;" [disabled]="isLoading" />
      </div>
    </div>
  </p-dialog>
</div>
<app-occ-error-modal *ngIf="showOCCErrorModalOrderCommission" (onClose)="showOCCErrorModalOrderCommission = false">
</app-occ-error-modal>
<p-toast/>